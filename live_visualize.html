<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyCoin Live Demo - Real-time Blockchain</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 15px;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .current-step {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .step-message {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 10px;
        }

        .step-narrative {
            font-size: 1.1em;
            color: #666;
            font-style: italic;
        }

        .wallets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .wallet-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .wallet-card:hover {
            transform: translateY(-5px);
        }

        .wallet-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .wallet-address {
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #888;
            margin-bottom: 15px;
            word-break: break-all;
        }

        .wallet-balance {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
        }

        .blockchain-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .block {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(50px) scale(0.95);
            transition: all 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .block.appear {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .block::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .block-index {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .block-hash {
            font-family: 'Courier New', monospace;
            background: #f0f0f0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            word-break: break-all;
            flex: 1;
            min-width: 200px;
        }

        .transaction-narrative-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.1em;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .transaction {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .transaction.coinbase {
            border-left-color: #28a745;
        }

        .tx-details {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
            margin-top: 10px;
        }

        .tx-arrow {
            font-size: 2em;
            color: #667eea;
        }

        .address {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .amount {
            color: #28a745;
            font-weight: bold;
            font-size: 1.1em;
        }

        .chain-arrow {
            text-align: center;
            color: white;
            font-size: 2em;
            padding: 10px 0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .chain-arrow.visible {
            opacity: 1;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            background: #28a745;
            color: white;
            margin-left: 10px;
        }

        .badge.coinbase {
            background: #ffc107;
            color: #333;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.5em;
            padding: 40px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü™ô PyCoin Live Demo</h1>
            <p class="subtitle">Watch the blockchain being built in real-time!</p>
            <div class="live-indicator">
                <div class="live-dot"></div>
                LIVE
            </div>
        </header>

        <div class="current-step" id="current-step">
            <div class="step-number" id="step-number">Step 0</div>
            <div class="step-message" id="step-message">Initializing...</div>
            <div class="step-narrative" id="step-narrative"></div>
        </div>

        <div id="wallets-section" style="display: none;">
            <h2 style="color: white; margin-bottom: 15px;">üëõ Wallets</h2>
            <div class="wallets-grid" id="wallets"></div>
        </div>

        <div id="blockchain-section" style="display: none;">
            <h2 style="color: white; margin: 30px 0 15px 0;">‚õìÔ∏è Blockchain</h2>
            <div class="blockchain-container" id="blockchain"></div>
        </div>
    </div>

    <script>
        let lastBlockCount = 0;
        let knownBlocks = new Set();

        function updateDisplay(data) {
            // Update step
            document.getElementById('step-number').textContent = `Step ${data.current_step}`;
            document.getElementById('step-message').textContent = data.message;
            document.getElementById('step-narrative').textContent = data.transaction_narrative || '';

            // Update wallets
            if (Object.keys(data.wallets).length > 0) {
                document.getElementById('wallets-section').style.display = 'block';
                updateWallets(data.wallets);
            }

            // Update blockchain
            if (data.blockchain && data.blockchain.chain) {
                document.getElementById('blockchain-section').style.display = 'block';
                updateBlockchain(data.blockchain);
            }
        }

        function updateWallets(wallets) {
            const container = document.getElementById('wallets');
            container.innerHTML = '';

            for (const [name, wallet] of Object.entries(wallets)) {
                const card = document.createElement('div');
                card.className = 'wallet-card';
                card.innerHTML = `
                    <div class="wallet-name">${name}</div>
                    <div class="wallet-address">${wallet.address}</div>
                    <div class="wallet-balance">${wallet.balance.toFixed(8)} PYC</div>
                `;
                container.appendChild(card);
            }
        }

        function updateBlockchain(blockchain) {
            const container = document.getElementById('blockchain');
            
            blockchain.chain.forEach((block, index) => {
                const blockId = `block-${block.index}`;
                
                if (!knownBlocks.has(blockId)) {
                    // New block - create it
                    knownBlocks.add(blockId);
                    
                    const blockDiv = document.createElement('div');
                    blockDiv.id = blockId;
                    blockDiv.className = 'block';
                    blockDiv.innerHTML = generateBlockHTML(block, blockchain);
                    container.appendChild(blockDiv);

                    // Add arrow if not last block
                    if (index < blockchain.chain.length - 1) {
                        const arrow = document.createElement('div');
                        arrow.id = `arrow-${block.index}`;
                        arrow.className = 'chain-arrow';
                        arrow.innerHTML = '‚¨á';
                        container.appendChild(arrow);
                    }

                    // Trigger animation
                    setTimeout(() => {
                        blockDiv.classList.add('appear');
                        const arrowEl = document.getElementById(`arrow-${block.index}`);
                        if (arrowEl) {
                            setTimeout(() => arrowEl.classList.add('visible'), 300);
                        }
                    }, 100);
                }
            });
        }

        function generateBlockHTML(block, blockchain) {
            return `
                <div class="block-header">
                    <div class="block-index">Block #${block.index}</div>
                    <div class="block-hash">
                        <strong>Hash:</strong> ${block.hash}
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div style="color: #888; font-size: 0.85em;">Previous Hash</div>
                        <div style="font-weight: bold; word-break: break-all; font-size: 0.85em;">${block.previous_hash.substring(0, 16)}...</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div style="color: #888; font-size: 0.85em;">Nonce</div>
                        <div style="font-weight: bold;">${block.nonce.toLocaleString()}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div style="color: #888; font-size: 0.85em;">Transactions</div>
                        <div style="font-weight: bold;">${block.transactions.length}</div>
                    </div>
                </div>

                <div>
                    <strong style="color: #667eea; font-size: 1.2em;">üí∞ Transactions</strong>
                    ${block.transactions.map((tx, i) => generateTransactionHTML(tx, blockchain)).join('')}
                </div>
            `;
        }

        function generateTransactionHTML(tx, blockchain) {
            const isCoinbase = tx.inputs[0].prev_tx_id === '0'.repeat(64);
            
            // Generate narrative
            let narrative = '';
            if (isCoinbase) {
                const reward = tx.outputs[0].amount / 100000000;
                const recipient = tx.outputs[0].recipient_address.substring(0, 10);
                narrative = `‚õèÔ∏è Mining Reward: ${reward} PYC to ${recipient}...`;
            } else if (tx.outputs.length === 2) {
                const amount = tx.outputs[0].amount / 100000000;
                const from = tx.outputs[1].recipient_address.substring(0, 10); // Change address
                const to = tx.outputs[0].recipient_address.substring(0, 10);
                narrative = `üì§ ${from}... sends ${amount} PYC to ${to}...`;
            }

            return `
                <div class="transaction ${isCoinbase ? 'coinbase' : ''}">
                    ${narrative ? `<div class="transaction-narrative-card">üìù ${narrative}</div>` : ''}
                    
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span style="font-family: 'Courier New', monospace; font-size: 0.85em;">
                            TX: ${tx.tx_id.substring(0, 24)}...
                        </span>
                        <span class="badge ${isCoinbase ? 'coinbase' : ''}">
                            ${isCoinbase ? 'COINBASE' : 'TRANSFER'}
                        </span>
                    </div>

                    <div class="tx-details">
                        <div>
                            <div style="color: #888; font-weight: bold; margin-bottom: 5px;">Inputs</div>
                            ${tx.inputs.map(input => `
                                <div class="address">
                                    ${isCoinbase ? '‚õèÔ∏è Mining' : input.prev_tx_id.substring(0, 12) + '...'}
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="tx-arrow">‚Üí</div>
                        
                        <div>
                            <div style="color: #888; font-weight: bold; margin-bottom: 5px;">Outputs</div>
                            ${tx.outputs.map(output => `
                                <div style="margin: 5px 0;">
                                    <div class="address">${output.recipient_address}</div>
                                    <div class="amount">${(output.amount / 100000000).toFixed(8)} PYC</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Poll for updates every second
        function pollUpdates() {
            fetch('/api/state')
                .then(response => response.json())
                .then(data => {
                    updateDisplay(data);
                })
                .catch(error => {
                    console.error('Error fetching state:', error);
                });
        }

        // Start polling
        setInterval(pollUpdates, 1000);
        pollUpdates(); // Initial fetch
    </script>
</body>
</html>

